<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glyph.js - Visual Execution Tracer</title>
    <style>
        /* KEEP ALL THE BEAUTIFUL CSS FROM THE NEW CHAT */
        :root {
            --primary: #4a6cf7;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --dark: #1e293b;
            --light: #f8fafc;
            --gray: #64748b;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #0f172a;
            color: var(--light);
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            border-bottom: 1px solid #334155;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, var(--primary), var(--success));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .subtitle {
            font-size: 1.1rem;
            color: var(--gray);
            margin-bottom: 20px;
        }
        
        .demo-links {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .demo-link {
            background: var(--primary);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .demo-link:hover {
            background: #3a5bd9;
            transform: translateY(-2px);
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .code-section, .execution-section {
            background: #1e293b;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .code-input {
            background: #0f172a;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid #334155;
        }
        
        textarea {
            width: 100%;
            height: 200px;
            background: transparent;
            color: var(--light);
            border: none;
            resize: vertical;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            padding: 10px;
        }
        
        textarea:focus {
            outline: none;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .execute-btn {
            background: var(--primary);
            color: white;
            flex: 1;
        }
        
        .execute-btn:hover {
            background: #3a5bd9;
            transform: translateY(-2px);
        }
        
        .time-travel-btn {
            background: var(--warning);
            color: white;
        }
        
        .time-travel-btn:hover {
            background: #d97706;
        }
        
        .clear-btn {
            background: #334155;
            color: var(--light);
        }
        
        .clear-btn:hover {
            background: #475569;
        }
        
        /* GLYPH-SPECIFIC STYLES */
        .execution-pipeline {
            background: #0f172a;
            border-radius: 8px;
            border: 1px solid #334155;
            padding: 20px;
            min-height: 400px;
            position: relative;
            overflow: auto;
        }
        
        .glyph-step {
            background: #1e293b;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .glyph-step.error {
            border-left-color: var(--error);
            background: rgba(239, 68, 68, 0.1);
        }
        
        .glyph-step.success {
            border-left-color: var(--success);
            background: rgba(16, 185, 129, 0.1);
        }
        
        .glyph-step.warning {
            border-left-color: var(--warning);
            background: rgba(245, 158, 11, 0.1);
        }
        
        .glyph-icon {
            font-size: 1.5rem;
            margin-right: 10px;
        }
        
        .step-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .step-title {
            font-weight: bold;
            color: var(--light);
            display: flex;
            align-items: center;
        }
        
        .step-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .status-success {
            background: var(--success);
            color: white;
        }
        
        .status-error {
            background: var(--error);
            color: white;
        }
        
        .status-warning {
            background: var(--warning);
            color: white;
        }
        
        .step-details {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 8px;
        }
        
        .step-data {
            background: #0f172a;
            padding: 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            margin-top: 8px;
            border: 1px solid #334155;
        }
        
        .time-travel-controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }
        
        .time-slider {
            flex: 1;
            height: 6px;
            background: #334155;
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }
        
        .time-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
        }
        
        .current-execution {
            position: absolute;
            left: -10px;
            top: 0;
            width: 4px;
            height: 100%;
            background: var(--primary);
            transition: top 0.5s ease;
            display: none;
        }
        
        .root-cause {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid var(--error);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .root-cause-title {
            color: var(--error);
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .fix-suggestion {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid var(--success);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .phase-indicator {
            display: inline-block;
            padding: 4px 12px;
            background: var(--primary);
            color: white;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-bottom: 15px;
        }
        
        .glyph-flow {
            display: flex;
            align-items: center;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        
        .flow-arrow {
            margin: 0 10px;
            color: var(--primary);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîÆ Glyph.js</h1>
            <div class="subtitle">Visual Execution Tracer & Time-Travel Debugger</div>
            <div class="demo-links">
                <a href="https://daktari-art.github.io/glyph-js/demos/error-time-travel.html" class="demo-link">Error Time-Travel Demo</a>
                <a href="https://daktari-art.github.io/glyph-js/mobile-demo.html" class="demo-link">Mobile Demo</a>
                <a href="https://daktari-art.github.io/glyph-js/demos/complex-scenario.html" class="demo-link">Complex Scenario</a>
            </div>
        </header>
        
        <div class="main-content">
            <div class="code-section">
                <h2 class="section-title">üîç Error Analysis</h2>
                <div class="phase-indicator">Chrome Extension MVP Phase</div>
                
                <div class="code-input">
                    <textarea id="codeInput" placeholder="Paste error stack trace or buggy code...">// REAL BUGGY CODE FROM OUR GLYPH TESTING
async function loadUserDashboard() {
    const userId = getUserIdFromURL(); // Might return undefined
    
    try {
        const userData = await fetchUserProfile(userId);
        const preferences = userData.settings.preferences; // üî• BUG HERE
        const [notifications, messages] = await Promise.all([
            fetchNotifications(userId),
            fetchMessages(userData.inboxId)
        ]);
        const dashboard = mergeDashboardData(userData, preferences, notifications, messages);
        renderDashboard(dashboard);
    } catch (error) {
        console.error('üí• Dashboard failed:', error);
    }
}

// Error: TypeError: Cannot read properties of undefined (reading 'preferences')</textarea>
                </div>
                
                <div class="controls">
                    <button id="executeBtn" class="execute-btn">üîÆ Trace Execution</button>
                    <button id="timeTravelBtn" class="time-travel-btn">‚è∞ Time Travel Debug</button>
                    <button id="clearBtn" class="clear-btn">üóëÔ∏è Clear</button>
                </div>
                
                <div class="demo-links">
                    <button class="demo-link" data-example="async-error">üîÑ Async Error</button>
                    <button class="demo-link" data-example="race-condition">‚ö° Race Condition</button>
                    <button class="demo-link" data-example="memory-leak">üíæ Memory Issue</button>
                </div>
            </div>
            
            <div class="execution-section">
                <h2 class="section-title">üéØ Visual Execution Trace</h2>
                <div class="execution-pipeline" id="pipeline">
                    <div class="current-execution" id="currentExecution"></div>
                    <!-- Glyph steps will be inserted here -->
                </div>
                
                <div class="time-travel-controls">
                    <input type="range" min="0" max="100" value="0" class="time-slider" id="timeSlider">
                    <button id="prevStep" class="time-travel-btn">‚Üê Prev</button>
                    <button id="nextStep" class="time-travel-btn">Next ‚Üí</button>
                </div>
                
                <div id="analysisResults">
                    <!-- Root cause and fix suggestions appear here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const codeInput = document.getElementById('codeInput');
            const executeBtn = document.getElementById('executeBtn');
            const timeTravelBtn = document.getElementById('timeTravelBtn');
            const clearBtn = document.getElementById('clearBtn');
            const pipeline = document.getElementById('pipeline');
            const timeSlider = document.getElementById('timeSlider');
            const prevStepBtn = document.getElementById('prevStep');
            const nextStepBtn = document.getElementById('nextStep');
            const currentExecution = document.getElementById('currentExecution');
            const analysisResults = document.getElementById('analysisResults');
            const demoLinks = document.querySelectorAll('.demo-link[data-example]');
            
            // GLYPH EXECUTION TRACES - Using our standardized glyph system
            const examples = {
                'async-error': {
                    code: `// REAL BUGGY CODE FROM OUR GLYPH TESTING
async function loadUserDashboard() {
    const userId = getUserIdFromURL();
    
    try {
        const userData = await fetchUserProfile(userId);
        const preferences = userData.settings.preferences; // üî• BUG
        const dashboard = mergeDashboardData(userData, preferences);
        renderDashboard(dashboard);
    } catch (error) {
        console.error('üí• Dashboard failed:', error);
    }
}`,
                    trace: [
                        { 
                            step: 'üì• User Login', 
                            status: 'success', 
                            icon: 'üì•',
                            data: 'User ID: 123', 
                            time: 0 
                        },
                        { 
                            step: 'üåê Fetch User Profile', 
                            status: 'success', 
                            icon: 'üåê',
                            data: 'User data loaded: {id: 123, name: "John"}', 
                            time: 500 
                        },
                        { 
                            step: '‚öôÔ∏è Access Preferences', 
                            status: 'error', 
                            icon: 'üí•',
                            data: 'TypeError: Cannot read properties of undefined (reading "preferences")', 
                            time: 600,
                            isError: true 
                        },
                        { 
                            step: 'üîÑ Error Handler', 
                            status: 'warning', 
                            icon: '‚ö†Ô∏è',
                            data: 'Generic catch block - no specific recovery', 
                            time: 700 
                        }
                    ],
                    rootCause: 'Data shape mismatch: userData.settings is undefined but code assumes it exists',
                    fix: 'Add null check: const preferences = userData.settings?.preferences || {};'
                },
                'race-condition': {
                    code: `// RACE CONDITION EXAMPLE
let user, profile;

fetchUser().then(data => user = data);
fetchProfile().then(data => profile = data);

// Use both - but profile might not be ready
setTimeout(() => {
    renderUserProfile(user, profile); // üí• profile undefined
}, 100);`,
                    trace: [
                        { 
                            step: 'üåê Fetch User', 
                            status: 'success', 
                            icon: 'üåê',
                            data: 'User data loaded', 
                            time: 0 
                        },
                        { 
                            step: 'üåê Fetch Profile', 
                            status: 'success', 
                            icon: 'üåê',
                            data: 'Profile data loaded', 
                            time: 150 
                        },
                        { 
                            step: '‚è∞ Timeout Trigger', 
                            status: 'warning', 
                            icon: '‚ö°',
                            data: 'Race condition: profile not ready yet', 
                            time: 100 
                        },
                        { 
                            step: 'üé® Render Profile', 
                            status: 'error', 
                            icon: 'üí•',
                            data: 'profile is undefined', 
                            time: 101,
                            isError: true 
                        }
                    ],
                    rootCause: 'Race condition: renderUserProfile called before fetchProfile completed',
                    fix: 'Use Promise.all([fetchUser(), fetchProfile()]).then(([user, profile]) => renderUserProfile(user, profile));'
                },
                'memory-leak': {
                    code: `// MEMORY LEAK EXAMPLE
class DataProcessor {
    constructor() {
        this.largeData = new Array(1000000).fill('data');
        window.addEventListener('click', this.handleClick);
    }
    
    handleClick = () => {
        processData(this.largeData); // Never cleaned up
    }
}`,
                    trace: [
                        { 
                            step: 'üè† Create Processor', 
                            status: 'success', 
                            icon: 'üè†',
                            data: 'Memory allocated: 8.3MB', 
                            time: 0 
                        },
                        { 
                            step: 'üéØ Add Event Listener', 
                            status: 'warning', 
                            icon: '‚ö†Ô∏è',
                            data: 'Potential leak: listener not removed', 
                            time: 1 
                        },
                        { 
                            step: 'üóëÔ∏è Destroy Processor', 
                            status: 'warning', 
                            icon: '‚ö†Ô∏è',
                            data: 'Memory not freed: 8.3MB retained', 
                            time: 2 
                        },
                        { 
                            step: 'üíæ Multiple Instances', 
                            status: 'error', 
                            icon: 'üí•',
                            data: 'Memory usage: 83MB and growing', 
                            time: 10,
                            isError: true 
                        }
                    ],
                    rootCause: 'Event listeners not removed on instance destruction',
                    fix: 'Add cleanup: window.removeEventListener("click", this.handleClick); in destroy method'
                }
            };
            
            // Set up demo buttons
            demoLinks.forEach(link => {
                link.addEventListener('click', function() {
                    const exampleType = this.getAttribute('data-example');
                    const example = examples[exampleType];
                    codeInput.value = example.code;
                    visualizeExecution(example.trace, example.rootCause, example.fix);
                });
            });
            
            // Execute trace - USING OUR ACTUAL BUGGY CODE
            executeBtn.addEventListener('click', function() {
                const code = codeInput.value;
                // Use our real buggy code example
                visualizeExecution(examples['async-error'].trace, examples['async-error'].rootCause, examples['async-error'].fix);
            });
            
            // Time travel debug
            timeTravelBtn.addEventListener('click', function() {
                startTimeTravel();
            });
            
            // Clear
            clearBtn.addEventListener('click', function() {
                codeInput.value = '';
                pipeline.innerHTML = '<div class="current-execution" id="currentExecution"></div>';
                analysisResults.innerHTML = '';
                currentExecution.style.display = 'none';
            });
            
            // Time travel controls
            timeSlider.addEventListener('input', updateTimeTravel);
            prevStepBtn.addEventListener('click', () => moveTimeTravel(-1));
            nextStepBtn.addEventListener('click', () => moveTimeTravel(1));
            
            let currentTrace = [];
            let currentStep = 0;
            

function visualizeExecution(trace, rootCause, fix) {
    currentTrace = trace;
    currentStep = trace.length - 1;
    
    console.log('üîÑ Visualizing execution with trace:', trace); // Debug log
    
    // Clear previous content
    pipeline.innerHTML = '';
    currentExecution = document.createElement('div');
    currentExecution.id = 'currentExecution';
    currentExecution.className = 'current-execution';
    pipeline.appendChild(currentExecution);
    
    // Add new steps
    trace.forEach((step, index) => {
        const stepEl = document.createElement('div');
        stepEl.className = `pipeline-step ${step.isError ? 'error' : step.status}`;
        stepEl.innerHTML = `
            <div class="step-header">
                <div class="step-title">${step.step}</div>
                <div class="step-status status-${step.status}">${step.status.toUpperCase()}</div>
            </div>
            <div class="step-details">Execution time: ${step.time}ms</div>
            <div class="step-data">${step.data}</div>
        `;
        pipeline.appendChild(stepEl);
    });
    
    // Show analysis - FIXED: This was missing
    analysisResults.innerHTML = `
        <div class="root-cause">
            <div class="root-cause-title">üîç Root Cause Identified</div>
            <div>${rootCause}</div>
        </div>
        <div class="fix-suggestion">
            <div class="root-cause-title" style="color: var(--success);">üí° Suggested Fix</div>
            <div><code>${fix}</code></div>
        </div>
    `;
    
    // Initialize time travel
    updateExecutionIndicator();
    
    console.log('‚úÖ Visualization complete'); // Debug log
}
            
            function startTimeTravel() {
                if (currentTrace.length === 0) return;
                
                currentStep = 0;
                updateTimeTravel();
                timeSlider.value = 0;
            }
            
            function updateTimeTravel() {
                if (currentTrace.length === 0) return;
                
                const stepIndex = Math.floor((timeSlider.value / 100) * (currentTrace.length - 1));
                currentStep = stepIndex;
                updateExecutionIndicator();
            }
            
            function moveTimeTravel(direction) {
                if (currentTrace.length === 0) return;
                
                currentStep = Math.max(0, Math.min(currentTrace.length - 1, currentStep + direction));
                timeSlider.value = (currentStep / (currentTrace.length - 1)) * 100;
                updateExecutionIndicator();
            }
            
            function updateExecutionIndicator() {
                if (currentTrace.length === 0) return;
                
                const steps = document.querySelectorAll('.glyph-step');
                if (steps.length === 0) return;
                
                const currentStepEl = steps[currentStep];
                const stepTop = currentStepEl.offsetTop - pipeline.offsetTop;
                const stepHeight = currentStepEl.offsetHeight;
                
                currentExecution.style.display = 'block';
                currentExecution.style.top = `${stepTop}px`;
                currentExecution.style.height = `${stepHeight}px`;
                
                // Highlight the current step
                steps.forEach((step, index) => {
                    step.style.opacity = index <= currentStep ? '1' : '0.5';
                });
            }
            
            // Initial demo - USING OUR REAL EXAMPLE
            visualizeExecution(examples['async-error'].trace, examples['async-error'].rootCause, examples['async-error'].fix);
        });
    </script>
</body>
</html>
