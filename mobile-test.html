<!DOCTYPE html>
<html>
<head>
    <title>Glyph.js Mobile Test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            padding: 20px;
            background: #0f172a;
            color: white;
            max-width: 100%;
            overflow-x: hidden;
        }
        .test-case { 
            background: #1e293b; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 8px;
        }
        button { 
            background: #3b82f6; 
            color: white; 
            border: none; 
            padding: 12px; 
            border-radius: 6px; 
            width: 100%;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <h2>ðŸ“± Glyph.js Mobile Test</h2>
    
    <div class="test-case">
        <h3>Async Operations</h3>
        <button onclick="testFetch()">Test Fetch API</button>
        <button onclick="testPromises()">Test Promises</button>
        <button onclick="testTimeouts()">Test Timeouts</button>
    </div>

    <div class="test-case">
        <h3>Error Scenarios</h3>
        <button onclick="testUndefinedError()">Undefined Access</button>
        <button onclick="testNetworkError()">Network Error</button>
        <button onclick="testMemoryLeak()">Memory Pattern</button>
    </div>

    <div id="results"></div>

    <script>
        // Test functions that will be traced by Glyph
        async function testFetch() {
            try {
                const response = await fetch('https://jsonplaceholder.typicode.com/users/1');
                const data = await response.json();
                showResult('Fetch Success: ' + data.name);
            } catch (error) {
                showResult('Fetch Error: ' + error.message);
            }
        }

        function testPromises() {
            new Promise((resolve) => {
                setTimeout(() => resolve('Promise resolved after 1s'), 1000);
            })
            .then(result => showResult(result))
            .catch(error => showResult('Promise error: ' + error));
        }

        function testTimeouts() {
            setTimeout(() => {
                showResult('Timeout executed');
            }, 500);
            
            setInterval(() => {
                showResult('Interval tick ' + Date.now());
            }, 2000);
        }

        function testUndefinedError() {
            try {
                const obj = undefined;
                showResult(obj.property); // This will error
            } catch (error) {
                showResult('Caught error: ' + error.message);
            }
        }

        function testNetworkError() {
            fetch('https://invalid-url-that-will-fail.com')
                .then(() => showResult('Unexpected success'))
                .catch(error => showResult('Network error caught: ' + error.message));
        }

        function testMemoryLeak() {
            // Simulate memory leak pattern
            window.leakyListeners = window.leakyListeners || [];
            const listener = () => console.log('leaky');
            window.addEventListener('scroll', listener);
            window.leakyListeners.push(listener);
            showResult('Added leaky event listener (check Glyph tracing)');
        }

        function showResult(message) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.style.background = '#334155';
            div.style.padding = '10px';
            div.style.margin = '5px 0';
            div.style.borderRadius = '4px';
            div.textContent = message;
            results.appendChild(div);
        }

        // Auto-test when page loads
        setTimeout(testFetch, 1000);
        setTimeout(testPromises, 1500);
    </script>
</body>
</html>
